import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,a,o as n}from"./app-VRpq1tPx.js";const l={};function t(r,s){return n(),e("div",null,[...s[0]||(s[0]=[a(`<p>Upgrading the DSF from 1.8.0 to 1.9.0 involves modifying the docker-compose.yml files, changing secret permissions, and recreating the containers.</p><div class="hint-container warning"><p class="hint-container-title">Update to DSF 1.7.0 first</p><p>When upgrading from DSF version &lt; 1.7.0 it is important to migrate to <a href="../v1.7.0/upgrade-from-1">DSF 1.7.0 first</a>.</p></div><h2 id="modify-dsf-fhir-server-setup" tabindex="-1"><a class="header-anchor" href="#modify-dsf-fhir-server-setup"><span>Modify DSF FHIR Server Setup</span></a></h2><ol><li><p>Preparation / Backup</p><ul><li>We recommend to create a backup of the <code>/opt/fhir</code> directory before proceeding with the upgrade.<br> For example using: <code>sudo cp -rp /opt/fhir /opt/fhir_backup_pre_1.9.0_upgrade</code></li></ul></li><li><p>Modify the DSF FHIR docker-compose.yml file, replace the version number with 1.9.0.</p></li></ol><div class="language-diff line-numbers-mode" data-highlighter="shiki" data-ext="diff" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-diff"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> version: &#39;3.8&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> services:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   proxy:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">-    image: ghcr.io/datasharingframework/fhir_proxy:1.8.0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+    image: ghcr.io/datasharingframework/fhir_proxy:1.9.0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     restart: on-failure</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   app:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">-    image: ghcr.io/datasharingframework/fhir:1.8.0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+    image: ghcr.io/datasharingframework/fhir:1.9.0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     restart: on-failure</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><p><strong>Adjust secret permissions (new in 1.9.0)</strong><br> Starting with DSF 1.9.0, the FHIR Proxy service runs as a <strong>non-root user</strong> inside its container.<br> To ensure continued access to certificates and keys, you must adjust ownership and permissions of the secrets folder.</p><p><strong>Target permissions:</strong></p><ul><li><strong>FHIR Server (app)</strong> runs as <code>uid=2101</code>/<code>gid=2101</code> → must read <strong>all secrets except</strong> the proxy-only SSL files.</li><li><strong>FHIR Proxy (proxy)</strong> runs as <code>uid=4101</code>/<code>gid=4101</code> → must read <strong>only</strong> secrets starting with <code>ssl_</code> (e.g. <code>ssl_certificate_file.pem</code>, <code>ssl_certificate_key_file.pem</code>).</li><li>To make this simple and compatible, we make all <code>ssl_*</code> files except (<code>ssl_certificate_file.pem</code>, <code>ssl_certificate_key_file.pem</code>) <strong>world-readable (0444)</strong>, allowing both users to access them.</li></ul><p><strong>Example (on FHIR host <code>/opt/fhir</code>):</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1) Make directory traversable for all (no write access)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root:2101</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 555</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2) Default: all secrets owned by root:2101, readable by owner+group</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root:2101</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 440</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 3) Exceptions: SSL files also readable by proxy, except the certificate and private</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 444</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 4) Ensure the SSL certificate and private key files are only readable by the proxy</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root:4101</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_certificate_file.pem</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root:4101</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_certificate_key_file.pem</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 440</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_certificate_file.pem</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 440</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_certificate_key_file.pem</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Advanced configuration to further constrain access privileges (Optional)</strong></p><p>If you prefer not to make ssl_* world-readable, use ACLs instead:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt-get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> acl</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # if needed</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> setfacl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> g:2101:r,g:4101:r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> setfacl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> o::0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Upgrade the DSF FHIR containers<br> From <code>/opt/fhir</code> execute</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>docker compose up -d &amp;&amp; docker compose logs -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h2 id="modify-dsf-bpe-server-setup" tabindex="-1"><a class="header-anchor" href="#modify-dsf-bpe-server-setup"><span>Modify DSF BPE Server Setup</span></a></h2><ol><li><p>Preparation / Backup</p><ul><li>We recommend to create a backup of the <code>/opt/bpe</code> directory before proceeding with the upgrade.<br> For example using: <code>sudo cp -rp /opt/bpe /opt/bpe_backup_pre_1.9.0_upgrade</code></li></ul></li><li><p>Modify the DSF BPE docker-compose.yml file, replace the version number with 1.9.0.</p></li></ol><div class="language-diff line-numbers-mode" data-highlighter="shiki" data-ext="diff" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-diff"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> version: &#39;3.8&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> services:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   app:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">-    image: ghcr.io/datasharingframework/bpe:1.8.0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">+    image: ghcr.io/datasharingframework/bpe:1.9.0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     restart: on-failure</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><p><strong>Adjust secret permissions (only if using BPE Proxy)</strong><br> If your setup includes a BPE Proxy (disabled by default), it also runs as non-root and needs read access to its certificate files.</p><p><strong>Target permissions:</strong></p><ul><li><strong>BPE Server (app)</strong> runs as <code>uid=2202</code>/<code>gid=2202</code> → read all secrets except proxy-only SSL files.</li><li><strong>BPE Proxy (proxy)</strong> runs as <code>uid=4202</code>/<code>gid=4202</code> → read only <code>ssl_*</code> files.</li></ul><p><strong>Example (on <code>/opt/bpe</code>):</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root:2202</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 555</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root:2202</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 440</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 444</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root:4202</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_certificate_file.pem</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root:4202</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_certificate_key_file.pem</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 440</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_certificate_file.pem</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 440</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secrets/ssl_certificate_key_file.pem</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Upgrade the DSF BPE containers<br> From <code>/opt/bpe</code> execute</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>docker compose up -d &amp;&amp; docker compose logs -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Verify your upgrade:</p><ul><li>Verify the DSF FHIR server is running in version 1.9.0. The log should contain a message:<br><code>INFO main - BuildInfoReaderImpl.logBuildInfo(137) | Artifact: dsf-fhir-server-jetty, version: 1.9.0, [...]</code></li><li>Verify the DSF FHIR server started without errors</li><li>Verify the DSF FHIR server is accessible via https, for example by browsing to <a href="https://your-dsf-endpoint.de/fhir/" target="_blank" rel="noopener noreferrer">https://your-dsf-endpoint.de/fhir/</a> (authentication with your client-certificate)</li><li>Verify the DSF BPE server is running in version 1.9.0. The log should contain a message:<br><code>INFO main - BuildInfoReaderImpl.logBuildInfo(137) | Artifact: dsf-bpe-server-jetty, version: 1.9.0, [...]</code></li><li>Verify the DSF BPE server started without errors</li><li>Verify your install with a ping/pong test</li></ul></li></ol>`,10)])])}const d=i(l,[["render",t]]),k=JSON.parse('{"path":"/operations/v1.9.0/upgrade-from-1.html","title":"Upgrade from DSF 1.8.0","lang":"en-US","frontmatter":{"title":"Upgrade from DSF 1.8.0","icon":"update"},"git":{"createdTime":1761053140000,"updatedTime":1761053140000,"contributors":[{"name":"Simon Schweizer","username":"","email":"simon-tobias.schweizer@hs-heilbronn.de","commits":1}]},"readingTime":{"minutes":2.28,"words":684},"filePathRelative":"operations/v1.9.0/upgrade-from-1.md","excerpt":"<p>Upgrading the DSF from 1.8.0 to 1.9.0 involves modifying the docker-compose.yml files, changing secret permissions, and recreating the containers.</p>\\n<div class=\\"hint-container warning\\">\\n<p class=\\"hint-container-title\\">Update to DSF 1.7.0 first</p>\\n<p>When upgrading from DSF version &lt; 1.7.0 it is important to migrate to <a href=\\"../v1.7.0/upgrade-from-1\\">DSF 1.7.0 first</a>.</p>\\n</div>"}');export{d as comp,k as data};
